"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8871],{51392:(e,n,t)=>{t.d(n,{q:()=>f});var r=t(6029),i=t(83150),o=t(44263),c=t(55729),s=t(30514),l=t(97275),a=t(98394),u=t(87931),d=t(83007),m=t(10196),h=t(21809);let x=(0,c.memo)(()=>{let{daemons:e}=(0,c.useContext)(h.d);return e?(0,r.jsx)(m.A,{content:e.content,position:"bottom",modifiers:{offset:{enabled:!0,options:{offset:[0,28]}}},children:(0,r.jsx)(u.In,{name:"warning",color:d.Ym()})}):null});var y=t(40264),j=t(75110);let g=(0,c.memo)(e=>{let{placeholder:n}=e,{codeLocations:t}=(0,c.useContext)(h.d);return t?"spinner"===t.type?(0,r.jsx)(y.m,{content:t.content,placement:"bottom",children:(0,r.jsx)(j.y,{purpose:"body-text",fillColor:d.fR()})}):(0,r.jsx)(m.A,{content:t.content,position:"bottom",modifiers:{offset:{enabled:!0,options:{offset:[0,28]}}},children:(0,r.jsx)(u.In,{name:"warning",color:d.Ym()})}):n?(0,r.jsx)("div",{style:{width:"16px"}}):null});var p=t(85725);let f=e=>{let{refreshState:n,tab:t}=e,{healthTitle:u}=(0,c.useContext)(s.y),d=(0,l.d)();return(0,r.jsxs)(i.a,{flex:{direction:"row",justifyContent:"space-between",alignItems:"flex-end"},children:[(0,r.jsxs)(o.tU,{selectedTabId:t,children:[(0,r.jsx)(p.s,{id:"locations",title:"Code locations",to:"/locations",icon:(0,r.jsx)(g,{placeholder:!1})}),(0,r.jsx)(p.s,{id:"health",title:u,to:"/health",icon:(0,r.jsx)(x,{})}),d?(0,r.jsx)(p.s,{id:"concurrency",title:"Concurrency",to:"/concurrency"}):null,d?(0,r.jsx)(p.s,{id:"config",title:"Configuration",to:"/config"}):null]}),n?(0,r.jsx)(i.a,{padding:{bottom:8},children:(0,r.jsx)(a.D7,{refreshState:n})}):null]})}},58871:(e,n,t)=>{t.r(n),t.d(n,{ConcurrencyLimits:()=>X,INSTANCE_CONCURRENCY_LIMITS_QUERY:()=>et,InstanceConcurrencyIndexContent:()=>W,InstanceConcurrencyPage:()=>B,InstanceConcurrencyPageContent:()=>M,RunConcurrencyContent:()=>G,default:()=>D});var r=t(9329),i=t(6029),o=t(83150),c=t(53451),s=t(78046),l=t(43697),a=t(3066),u=t(51784),d=t(33658),m=t(96331),h=t(1806),x=t(83655),y=t(87931),j=t(41499),g=t(97228),p=t(55729),f=t(3102),C=t(44263);let b=e=>{let{activeTab:n,onChange:t}=e;return(0,i.jsxs)(C.tU,{selectedTabId:n,onChange:t,children:[(0,i.jsx)(C.oz,{title:"Pools",id:"key-concurrency",selected:"key-concurrency"===n}),(0,i.jsx)(C.oz,{title:"Run tag concurrency",id:"run-concurrency",selected:"run-concurrency"===n})]})};var v=t(56586),I=t(30514),S=t(51392),w=t(59541),R=t(21440),L=t(38584),k=t(41735),K=t(85347),_=t(98394),T=t(41185),N=t(11665);function Q(){let e=(0,r._)(["\n  query SingleConcurrencyKeyQuery($concurrencyKey: String!) {\n    instance {\n      id\n      concurrencyLimit(concurrencyKey: $concurrencyKey) {\n        concurrencyKey\n        slotCount\n        claimedSlots {\n          runId\n          stepKey\n        }\n        pendingSteps {\n          runId\n          stepKey\n          enqueuedTimestamp\n          assignedTimestamp\n          priority\n        }\n      }\n    }\n  }\n"]);return Q=function(){return e},e}let $="1fr 1fr",A=e=>{let{concurrencyKeys:n}=e,t=(0,p.useRef)(null),r=(0,R.Te)({count:n.length,getScrollElement:()=>t.current,estimateSize:()=>64,overscan:10}),o=r.getTotalSize(),c=r.getVirtualItems();return(0,i.jsx)("div",{style:{overflow:"hidden"},children:(0,i.jsxs)(T.mc,{ref:t,children:[(0,i.jsx)(V,{}),(0,i.jsx)(T.Rp,{$totalHeight:o,children:c.map(e=>{let{index:t,key:r,size:o,start:c}=e,s=n[t];return(0,i.jsx)(Y,{concurrencyKey:s,height:o,start:c},r)})})]})})},V=()=>(0,i.jsxs)(T.Sy,{templateColumns:$,sticky:!0,children:[(0,i.jsx)(T.A3,{children:"Pool"}),(0,i.jsx)(T.A3,{children:"Limit"})]}),Y=e=>{let{concurrencyKey:n,height:t,start:r}=e,c=(0,w.V)(100),s=(0,K.IT)(z,{variables:{concurrencyKey:n},skip:!c});(0,_.Bj)(s,_.eO);let{data:l}=s,a=null==l?void 0:l.instance.concurrencyLimit,u="/deployment/concurrency/".concat(encodeURIComponent(n));return(0,i.jsx)(T.fI,{$height:t,$start:r,children:(0,i.jsxs)(E,{border:"bottom",children:[(0,i.jsx)(T.$4,{children:(0,i.jsxs)(o.a,{flex:{gap:4,alignItems:"center"},children:[(0,i.jsx)(y.In,{name:"dynamic_feed"}),(0,i.jsx)(L.N_,{to:u,children:n})]})}),(0,i.jsx)(T.$4,{children:a?(0,i.jsx)("div",{children:a.slotCount}):(0,i.jsx)(N.ov,{queryResult:s})})]})})},z=(0,K.J1)(Q()),E=(0,k.Ay)(o.a).withConfig({componentId:"sc-c6d13853-0"})(["display:grid;grid-template-columns:",";height:100%;"],$);var q=t(76655),F=t(32857),P=t(56808);function O(){let e=(0,r._)(["\n  fragment RunQueueConfigFragment on RunQueueConfig {\n    maxConcurrentRuns\n    tagConcurrencyLimitsYaml\n  }\n"]);return O=function(){return e},e}function U(){let e=(0,r._)(["\n  query InstanceConcurrencyLimitsQuery {\n    instance {\n      id\n      supportsConcurrencyLimits\n      runQueuingSupported\n      runQueueConfig {\n        ...RunQueueConfigFragment\n      }\n      minConcurrencyLimitValue\n      maxConcurrencyLimitValue\n      concurrencyLimits {\n        concurrencyKey\n      }\n    }\n  }\n\n  ","\n"]);return U=function(){return e},e}function J(){let e=(0,r._)(["\n  mutation SetConcurrencyLimit($concurrencyKey: String!, $limit: Int!) {\n    setConcurrencyLimit(concurrencyKey: $concurrencyKey, limit: $limit)\n  }\n"]);return J=function(){return e},e}let M=p.memo(()=>{let{concurrencyKey:e}=(0,f.g)();if(!e)return(0,i.jsx)(W,{});let n=decodeURIComponent(e);return(0,i.jsx)(v.If,{concurrencyKey:n})}),W=p.memo(()=>{(0,F.b7)(),(0,P.r)("Concurrency");let e=(0,K.IT)(et,{notifyOnNetworkStatusChange:!0}),[n,t]=p.useState("key-concurrency"),{data:r}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(H,{activeTab:n,onChange:t}),r?"run-concurrency"===n?(0,i.jsx)("div",{style:{overflowY:"auto"},children:(0,i.jsx)(G,{hasRunQueue:!!(null==r?void 0:r.instance.runQueuingSupported),runQueueConfig:null==r?void 0:r.instance.runQueueConfig})}):(0,i.jsx)("div",{style:{overflowY:"hidden"},children:(0,i.jsx)(X,{concurrencyKeys:r.instance.concurrencyLimits.map(e=>e.concurrencyKey),hasSupport:r.instance.supportsConcurrencyLimits,refetch:e.refetch,minValue:r.instance.minConcurrencyLimitValue,maxValue:r.instance.maxConcurrencyLimitValue})}):(0,i.jsx)(o.a,{padding:{vertical:64},flex:{direction:"column",alignItems:"center"},children:(0,i.jsx)(c.V,{label:"Loading concurrency informationâ€¦"})})]})}),B=()=>{let{pageTitle:e}=p.useContext(I.y);return(0,i.jsxs)(s.Y,{style:{padding:0},children:[(0,i.jsx)(l.z,{title:(0,i.jsx)(a.M7,{children:e}),tabs:(0,i.jsx)(S.q,{tab:"concurrency"})}),(0,i.jsx)(W,{})]})},D=B,G=e=>{let{hasRunQueue:n,runQueueConfig:t}=e;if(!n)return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.a,{padding:{vertical:16,horizontal:24},border:"bottom",flex:{direction:"row",alignItems:"center",justifyContent:"space-between"},children:(0,i.jsx)(a.R2,{children:"Run tag concurrency"})}),(0,i.jsxs)(o.a,{padding:{vertical:16,horizontal:24},children:["Run concurrency is not supported with this run coordinator. To enable run concurrency limits, configure your instance to use the ",(0,i.jsx)(a.Kp,{children:"QueuedRunCoordinator"})," in your"," ",(0,i.jsx)(a.Kp,{children:"dagster.yaml"}),". See the"," ",(0,i.jsx)("a",{target:"_blank",rel:"noreferrer",href:"https://docs.dagster.io/deployment/dagster-instance#queuedruncoordinator",children:"QueuedRunCoordinator documentation"})," ","for more information."]})]});let r=(0,i.jsxs)(o.a,{padding:{vertical:24,horizontal:24},children:["Run tag concurrency can be set in your deployment settings. See the"," ",(0,i.jsx)("a",{target:"_blank",rel:"noreferrer",href:"https://docs.dagster.io/guides/limiting-concurrency-in-data-pipelines#configuring-run-level-concurrency",children:"concurrency documentation"})," ","for more information."]}),c=t?(0,i.jsx)(u.Wy,{style:{marginLeft:-1},children:(0,i.jsxs)("tbody",{children:[(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:"Max concurrent runs:"}),(0,i.jsx)("td",{children:t.maxConcurrentRuns})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:"Tag concurrency limits:"}),(0,i.jsx)("td",{children:t.tagConcurrencyLimitsYaml?(0,i.jsx)(g.O,{value:t.tagConcurrencyLimitsYaml,options:{readOnly:!0,lineNumbers:!0,mode:"yaml"}}):"-"})]})]})}):null;return(0,i.jsxs)(o.a,{children:[r,c]})},H=e=>{let{activeTab:n,onChange:t}=e;return(0,i.jsx)(o.a,{flex:{justifyContent:"space-between",alignItems:"center"},padding:{horizontal:24},border:"bottom",children:(0,i.jsx)(b,{activeTab:n,onChange:t})})},X=e=>{let{hasSupport:n,concurrencyKeys:t,refetch:r,minValue:c,maxValue:s}=e,[l,a]=p.useState(!1),[u,h]=p.useState(""),x=()=>a(!0),y=p.useMemo(()=>[...t].filter(e=>e.includes(u)).sort((e,n)=>q.Vp.compare(e,n)),[t,u]);return n?(0,i.jsxs)(o.a,{flex:{direction:"column"},style:{overflow:"auto",height:"100%"},children:[(0,i.jsx)(Z,{onAdd:x,search:u,setSearch:h}),0===t.length?(0,i.jsx)(o.a,{margin:24,children:(0,i.jsx)(d.I,{icon:"error",title:"No pool limits",description:(0,i.jsxs)(i.Fragment,{children:["No pool limits have been configured for this instance.\xa0",(0,i.jsx)(m.v,{onClick:()=>x(),children:"Add a pool limit"}),"."]})})}):y.length?(0,i.jsx)(A,{concurrencyKeys:y}):(0,i.jsx)(o.a,{padding:16,children:(0,i.jsx)(d.I,{icon:"no-results",title:"No pool limits",description:"No pool limits matching the filter."})}),(0,i.jsx)(ee,{open:!!l,onClose:()=>a(!1),onComplete:r,minValue:null!=c?c:1,maxValue:null!=s?s:1e3})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(Z,{}),(0,i.jsx)(o.a,{margin:24,children:(0,i.jsx)(d.I,{icon:"error",title:"No concurrency support",description:"This instance does not currently support pool-based concurrency limits. You may need to run `dagster instance migrate` to add the necessary tables to your dagster storage to support this feature."})})]})},Z=e=>{let{onAdd:n,setSearch:t,search:r}=e;return(0,i.jsx)(o.a,{flex:{direction:"column"},children:t?(0,i.jsxs)(o.a,{flex:{direction:"row",justifyContent:"space-between"},padding:{vertical:16,horizontal:24},border:"bottom",children:[(0,i.jsx)(h.ks,{value:r||"",style:{width:"30vw",minWidth:150,maxWidth:400},placeholder:"Filter pools",onChange:e=>t(e.target.value)}),n?(0,i.jsx)(x.$n,{icon:(0,i.jsx)(y.In,{name:"add_circle"}),onClick:()=>n(),children:"Add pool limit"}):null]}):null})},ee=e=>{let{open:n,onClose:t,onComplete:r,maxValue:c,minValue:s}=e,[l,a]=p.useState(!1),[u,d]=p.useState(""),[m,y]=p.useState("");p.useEffect(()=>{d(""),y("")},[n]);let[g]=(0,K.n_)(er),f=async()=>{a(!0),await g({variables:{concurrencyKey:m,limit:parseInt(u.trim())}}),a(!1),r(),t()};return(0,i.jsxs)(j.lG,{isOpen:n,title:"Add pool limit",onClose:t,children:[(0,i.jsxs)(j.R4,{children:[(0,i.jsx)(o.a,{margin:{bottom:4},children:"Pool:"}),(0,i.jsx)(o.a,{margin:{bottom:16},children:(0,i.jsx)(h.ks,{value:m||"",onChange:e=>y(e.target.value),placeholder:"Pool"})}),(0,i.jsxs)(o.a,{margin:{bottom:4},children:["Pool limit (",s,"-",c,"):"]}),(0,i.jsx)(o.a,{children:(0,i.jsx)(h.ks,{value:u||"",onChange:e=>d(e.target.value),placeholder:"".concat(s," - ").concat(c)})})]}),(0,i.jsxs)(j.Es,{children:[(0,i.jsx)(x.$n,{intent:"none",onClick:t,children:"Cancel"}),(0,i.jsx)(x.$n,{intent:"primary",onClick:f,disabled:!(0,v._k)(u.trim(),s,c)||!m||l,children:l?"Adding...":"Add limit"})]})]})},en=(0,K.J1)(O()),et=(0,K.J1)(U(),en),er=(0,K.J1)(J())},78046:(e,n,t)=>{t.d(n,{Y:()=>r});let r=t(41735).Ay.div.withConfig({componentId:"sc-2cf5acf-0"})(["height:100%;overflow-y:auto;padding-bottom:64px;width:100%;"])}}]);
//# sourceMappingURL=8871.e76c5d0c2ba0d469.js.map