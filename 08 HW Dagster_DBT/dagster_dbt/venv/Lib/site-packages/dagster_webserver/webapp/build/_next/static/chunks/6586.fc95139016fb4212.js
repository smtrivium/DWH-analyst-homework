"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6586],{56586:(e,n,t)=>{t.d(n,{If:()=>z,_k:()=>q,bV:()=>M});var r=t(9329),i=t(6029),s=t(83150),l=t(3066),o=t(17970),c=t(9754),a=t(83655),d=t(87931),u=t(93955),x=t(51784),p=t(83007),h=t(53451),j=t(41499),m=t(1806),y=t(40264),g=t(33658),f=t(56329),I=t(55729),v=t(3102),b=t(38584),C=t(85347),w=t(47705),S=t(63510),_=t(83900),K=t(98394),R=t(32857),k=t(66822),$=t(56808),T=t(60845),F=t(1546),D=t(61365),L=t(89250),E=t(6965);function U(){let e=(0,r._)(["\n  mutation SetConcurrencyLimit($concurrencyKey: String!, $limit: Int!) {\n    setConcurrencyLimit(concurrencyKey: $concurrencyKey, limit: $limit)\n  }\n"]);return U=function(){return e},e}function A(){let e=(0,r._)(["\n  mutation DeleteConcurrencyLimit($concurrencyKey: String!) {\n    deleteConcurrencyLimit(concurrencyKey: $concurrencyKey)\n  }\n"]);return A=function(){return e},e}function N(){let e=(0,r._)(["\n  mutation FreeConcurrencySlots($runId: String!, $stepKey: String) {\n    freeConcurrencySlots(runId: $runId, stepKey: $stepKey)\n  }\n"]);return N=function(){return e},e}function P(){let e=(0,r._)(["\n  query RunsForConcurrencyKeyQuery($filter: RunsFilter, $limit: Int) {\n    pipelineRunsOrError(filter: $filter, limit: $limit) {\n      ... on Runs {\n        results {\n          id\n          status\n        }\n      }\n    }\n  }\n"]);return P=function(){return e},e}let z=e=>{var n,t;let{concurrencyKey:r}=e;(0,R.b7)(),(0,$.r)("Pool: ".concat(r));let[j,m]=I.useState(),[y,g]=I.useState(!1),f=(0,C.IT)(w.Z,{variables:{pool:r}}),{data:S,refetch:k}=f,T=null==S?void 0:S.instance.concurrencyLimit,D=null==S?void 0:S.instance.runQueuingSupported,L=(0,K.Bj)(f,K.eO),E=(0,v.W6)(),U=null==S||null==(n=S.instance.poolConfig)?void 0:n.poolGranularity;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{style:{overflowY:"auto"},children:T?(0,i.jsxs)(s.a,{children:[(0,i.jsxs)(s.a,{padding:{vertical:16,horizontal:24},flex:{direction:"row",alignItems:"center",justifyContent:"space-between"},border:"bottom",children:[(0,i.jsx)(l.DZ,{children:(0,i.jsxs)(s.a,{flex:{direction:"row",gap:8,alignItems:"center"},children:[(0,i.jsx)("div",{children:(0,i.jsx)(b.N_,{to:"/deployment/concurrency",children:"Pools"})}),(0,i.jsx)("div",{children:"/"}),(0,i.jsx)("div",{children:r})]})}),(0,i.jsxs)(s.a,{flex:{direction:"row",gap:8,alignItems:"center"},children:[(0,i.jsx)(K.D7,{refreshState:L}),(0,i.jsx)(o.AM,{position:"bottom-right",content:(0,i.jsx)(c.W1,{children:(0,i.jsx)(c.Dr,{icon:"delete",text:"Delete",intent:"danger",onClick:()=>g(!0)})}),children:(0,i.jsx)(a.$n,{icon:(0,i.jsx)(d.In,{name:"expand_more"})})})]})]}),(0,i.jsx)(s.a,{padding:{vertical:16,horizontal:24},children:(0,i.jsx)(l.R2,{children:"Pool info"})}),D||"op"===U?null:(0,i.jsx)(s.a,{margin:{horizontal:20,bottom:20},children:(0,i.jsx)(u.F,{intent:"warning",title:"Run granularity for pools not supported",description:(0,i.jsxs)(i.Fragment,{children:["The pool granularity is set to ",(0,i.jsx)(l.Kp,{children:"run"}),", but run-level concurrency is not supported with this run coordinator. To enable run granularity for pools, configure your instance to use the default ",(0,i.jsx)(l.Kp,{children:"QueuedRunCoordinator"})," ","in your ",(0,i.jsx)(l.Kp,{children:"dagster.yaml"}),". See the"," ",(0,i.jsx)("a",{target:"_blank",rel:"noreferrer",href:"https://docs.dagster.io/deployment/dagster-instance#queuedruncoordinator",children:"QueuedRunCoordinator documentation"})," ","for more information."]})})}),(0,i.jsx)(s.a,{padding:{bottom:24},children:(0,i.jsx)(x.Wy,{style:{marginLeft:-1},children:(0,i.jsxs)("tbody",{children:[(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{verticalAlign:"middle"},children:"Granularity"}),(0,i.jsx)("td",{children:"run"===U?"Run":"Op"})]}),(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{style:{verticalAlign:"middle"},children:"Limit"}),(0,i.jsx)("td",{children:(0,i.jsxs)(s.a,{flex:{justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsxs)(s.a,{flex:{direction:"row",gap:8,alignItems:"center"},children:[(0,i.jsx)("div",{children:T.slotCount?T.slotCount:null===T.limit?(0,i.jsx)(i.Fragment,{children:"—"}):T.limit}),T.usingDefaultLimit?(0,i.jsx)(l.HL,{color:p._l(),children:"(default)"}):null]}),(0,i.jsx)(a.$n,{icon:(0,i.jsx)(d.In,{name:"edit"}),onClick:()=>m(!0),children:"Edit limit"})]})})]})]})})}),(null==S||null==(t=S.instance.poolConfig)?void 0:t.poolGranularity)!=="run"?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.a,{padding:{vertical:16,horizontal:24},flex:{direction:"row",alignItems:"center",justifyContent:"space-between"},children:(0,i.jsx)(l.R2,{children:"In progress steps"})}),(0,i.jsx)(s.a,{style:{marginLeft:-1},children:(0,i.jsx)(G,{keyInfo:T,refresh:k})}),(0,i.jsx)(s.a,{padding:{vertical:16,horizontal:24},flex:{direction:"row",alignItems:"center",justifyContent:"space-between"},children:(0,i.jsx)(l.R2,{children:"Queued runs"})}),(0,i.jsx)(W,{pool:r,runStatuses:F.Ii})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.a,{padding:{vertical:16,horizontal:24},flex:{direction:"row",alignItems:"center",justifyContent:"space-between"},children:(0,i.jsx)(l.R2,{children:"In progress"})}),(0,i.jsx)(W,{pool:r,runStatuses:F.Tk}),(0,i.jsx)(s.a,{padding:{vertical:16,horizontal:24},flex:{direction:"row",alignItems:"center",justifyContent:"space-between"},children:(0,i.jsx)(l.R2,{children:"Queued"})}),(0,i.jsx)(W,{pool:r,runStatuses:F.Ii})]})]}):(0,i.jsx)(s.a,{flex:{direction:"column",alignItems:"center"},padding:{vertical:64},children:(0,i.jsx)(h.V,{label:"Loading…"})})}),(0,i.jsx)(O,{concurrencyKey:r,open:!!j,onClose:()=>m(!1),onComplete:k,minValue:(null==S?void 0:S.instance.minConcurrencyLimitValue)||0,maxValue:(null==S?void 0:S.instance.maxConcurrencyLimitValue)||1e3}),(0,i.jsx)(Q,{concurrencyKey:r,open:!!y,onClose:()=>g(!1),onComplete:()=>{E.push("/deployment/concurrency"),(0,_.l)({icon:"trash",intent:"success",message:"Deleted pool limit"})}})]})},q=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;if(!e)return!1;let r=parseInt(e);return!isNaN(r)&&String(r)===e.trim()&&r>=n&&r<=t},O=e=>{let{concurrencyKey:n,open:t,onClose:r,onComplete:o,minValue:c,maxValue:d}=e,[u,x]=I.useState(!1),[p,h]=I.useState("");I.useEffect(()=>{h("")},[t]);let[y]=(0,C.n_)(J),g=async()=>{x(!0),await y({variables:{concurrencyKey:n,limit:parseInt(p.trim())}}),x(!1),o(),r()};return(0,i.jsxs)(j.lG,{isOpen:t,title:(0,i.jsxs)("span",{children:["Edit ",(0,i.jsx)(l.Kp,{children:n})]}),onClose:r,children:[(0,i.jsxs)(j.R4,{children:[(0,i.jsx)(s.a,{margin:{bottom:4},children:"Pool:"}),(0,i.jsx)(s.a,{margin:{bottom:16},children:(0,i.jsx)("strong",{children:n})}),(0,i.jsxs)(s.a,{margin:{bottom:4},children:["Pool limit (",c,"-",d,"):"]}),(0,i.jsx)(s.a,{children:(0,i.jsx)(m.ks,{value:p||"",onChange:e=>h(e.target.value),placeholder:"".concat(c," - ").concat(d)})})]}),(0,i.jsxs)(j.Es,{children:[(0,i.jsx)(a.$n,{intent:"none",onClick:r,children:"Close"}),u?(0,i.jsx)(a.$n,{intent:"primary",disabled:!0,children:"Updating…"}):(0,i.jsx)(a.$n,{intent:"primary",onClick:g,disabled:!q(p.trim(),c,d),children:"Update limit"})]})]})},Q=e=>{let{concurrencyKey:n,open:t,onClose:r,onComplete:s}=e,[o,c]=I.useState(!1),[d]=(0,C.n_)(H),u=async()=>{c(!0),await d({variables:{concurrencyKey:n}}),c(!1),s(),r()},x=(0,i.jsxs)(i.Fragment,{children:["Delete ",(0,i.jsx)(l.Kp,{children:n})]});return(0,i.jsxs)(j.lG,{isOpen:t,title:x,onClose:r,children:[(0,i.jsxs)(j.R4,{children:["Delete concurrency limit\xa0",(0,i.jsx)("strong",{children:n}),"?"]}),(0,i.jsxs)(j.Es,{children:[(0,i.jsx)(a.$n,{onClick:r,children:"Close"}),(0,i.jsx)(a.$n,{intent:"danger",disabled:o,onClick:u,children:o?"Deleting…":"Delete limit"})]})]})},V=e=>{let{pendingStep:n,onUpdate:t}=e,[r]=(0,C.n_)(M);return(0,i.jsx)(o.AM,{content:(0,i.jsxs)(c.W1,{children:[(0,i.jsx)(c.Dr,{icon:"status",text:"Free concurrency slot for step",onClick:async()=>{var e;(null==(e=(await r({variables:{runId:n.runId,stepKey:n.stepKey}})).data)?void 0:e.freeConcurrencySlots)&&(t(),await (0,_.l)({intent:"success",icon:"copy_to_clipboard_done",message:"Freed concurrency slot"}))}},"free-concurrency-slots-step"),(0,i.jsx)(c.Dr,{icon:"status",text:"Free all concurrency slots for run",onClick:async()=>{var e;await (0,_.l)({intent:"primary",message:"Freeing concurrency slots..."}),(null==(e=(await r({variables:{runId:n.runId}})).data)?void 0:e.freeConcurrencySlots)&&(t(),await (0,_.l)({intent:"success",icon:"copy_to_clipboard_done",message:"Freed concurrency slots"}))}},"free-concurrency-slots-run")]}),position:"bottom-right",children:(0,i.jsx)(a.$n,{rightIcon:(0,i.jsx)(d.In,{name:"expand_more"}),children:"Actions"})})},W=e=>{let{pool:n,runStatuses:t}=e,r={statuses:Array.from(t),tags:[{key:"".concat(D.d.PoolTagPrefix,"/").concat(n),value:"true"}]};return(0,i.jsx)(S.U,{filter:r,includeRunsFromBackfills:!0,emptyState:()=>(0,i.jsx)(s.a,{padding:{vertical:24},flex:{direction:"column",alignItems:"center"},children:t.has(k.i2_.STARTED)?"No matching runs in progress.":"No matching runs in queue."})})},G=e=>{var n;let{keyInfo:t,refresh:r}=e,l=[...new Set(t.pendingSteps.map(e=>e.runId))],o=(0,C.IT)(Z,{variables:{filter:{runIds:l}},skip:!t.pendingSteps.length}),c={};((null==(n=o.data)?void 0:n.pipelineRunsOrError.__typename)==="Runs"?o.data.pipelineRunsOrError.results:[]).forEach(e=>{c[e.id]=e.status});let a=[...t.pendingSteps];a.sort((e,n)=>e.priority&&n.priority&&e.priority!==n.priority?e.priority-n.priority:e.enqueuedTimestamp-n.enqueuedTimestamp);let u=a.filter(e=>!!e.assignedTimestamp),x=a.filter(e=>!e.assignedTimestamp),h=(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Run ID"}),(0,i.jsx)("th",{children:"Step key"}),(0,i.jsx)("th",{children:"Assigned"}),(0,i.jsx)("th",{children:"Queued"}),(0,i.jsx)("th",{children:(0,i.jsxs)(s.a,{flex:{alignItems:"center",direction:"row",gap:4},children:["Priority",(0,i.jsx)(y.m,{placement:"top",content:"Priority can be set on each op/asset using the 'dagster/priority' tag. Higher priority steps will be assigned slots first.",children:(0,i.jsx)(d.In,{name:"info",color:p.fR()})})]})}),(0,i.jsx)("th",{})]})});return a.length?(0,i.jsxs)(f.X,{children:[h,(0,i.jsx)("tbody",{style:{backgroundColor:p.ao()},children:u.map(e=>(0,i.jsx)(B,{step:e,statusByRunId:c,onUpdate:r},e.runId+e.stepKey))}),(0,i.jsx)("tbody",{children:x.map(e=>(0,i.jsx)(B,{step:e,statusByRunId:c,onUpdate:r},e.runId+e.stepKey))})]}):(0,i.jsx)(g.I,{icon:"no-results",title:"No active steps",description:"There are no active or pending steps for this pool."})},B=e=>{let{step:n,statusByRunId:t,onUpdate:r}=e,o=t[n.runId];return(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:o?(0,i.jsx)(b.N_,{to:"/runs/".concat(n.runId),children:(0,i.jsxs)(s.a,{flex:{direction:"row",alignItems:"center",gap:8},children:[(0,i.jsx)(T.vA,{status:o,size:10}),(0,i.jsx)(l.Kp,{children:(0,L.fb)({id:n.runId})}),F.ev.has(o)?(0,i.jsx)(y.m,{placement:"top",content:"Slots for canceled / failed runs can automatically be freed by configuring a run monitoring setting.",children:(0,i.jsx)(d.In,{name:"info",color:p.fR()})}):null]})}):(0,i.jsx)(l.Kp,{children:(0,L.fb)({id:n.runId})})}),(0,i.jsx)("td",{children:(0,i.jsx)(l.Kp,{children:n.stepKey})}),(0,i.jsx)("td",{children:n.assignedTimestamp?(0,i.jsx)(E.W,{startUnix:n.assignedTimestamp,endUnix:null}):"-"}),(0,i.jsx)("td",{children:n.enqueuedTimestamp?(0,i.jsx)(E.W,{startUnix:n.enqueuedTimestamp,endUnix:null}):"-"}),(0,i.jsx)("td",{children:n.priority}),(0,i.jsx)("td",{children:(0,i.jsx)(V,{pendingStep:n,onUpdate:r})})]})},J=(0,C.J1)(U()),H=(0,C.J1)(A()),M=(0,C.J1)(N()),Z=(0,C.J1)(P())}}]);
//# sourceMappingURL=6586.fc95139016fb4212.js.map